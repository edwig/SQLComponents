-- FIREBIRD TRIGGER SOURCE

SELECT
  'CREATE OR ALTER TRIGGER "' || TRIM(rdb$trigger_name) || '"' || ASCII_CHAR(10) ||
  CASE rdb$trigger_inactive
    WHEN 0 THEN 'ACTIVE'
    WHEN 1 THEN 'INACTIVE'
           ELSE ''
  END || ASCII_CHAR(10) ||
  CASE 
    -- Table-level triggers
    WHEN rdb$trigger_type BETWEEN 1 AND 114 THEN
      CASE rdb$trigger_type
        WHEN   1 THEN 'BEFORE INSERT'
        WHEN   2 THEN 'AFTER INSERT'
        WHEN   3 THEN 'BEFORE UPDATE'
        WHEN   4 THEN 'AFTER UPDATE'
        WHEN   5 THEN 'BEFORE DELETE'
        WHEN   6 THEN 'AFTER DELETE'
        WHEN  17 THEN 'BEFORE INSERT OR UPDATE'
        WHEN  18 THEN 'AFTER INSERT OR UPDATE'
        WHEN  25 THEN 'BEFORE INSERT OR DELETE'
        WHEN  26 THEN 'AFTER INSERT OR DELETE'
        WHEN  27 THEN 'BEFORE UPDATE OR DELETE'
        WHEN  28 THEN 'AFTER UPDATE OR DELETE'
        WHEN 113 THEN 'BEFORE INSERT OR UPDATE OR DELETE'
        WHEN 114 THEN 'AFTER INSERT OR UPDATE OR DELETE'
      END || ' ON "' || TRIM(rdb$relation_name) || '"'

    -- Database-level triggers
    WHEN rdb$trigger_type BETWEEN 8192 AND 8196 THEN
      CASE rdb$trigger_type
        WHEN 8192 THEN 'ON CONNECT'
        WHEN 8193 THEN 'ON DISCONNECT'
        WHEN 8194 THEN 'ON TRANSACTION START'
        WHEN 8195 THEN 'ON TRANSACTION COMMIT'
        WHEN 8196 THEN 'ON TRANSACTION ROLLBACK'
      END

    -- DDL triggers
    WHEN rdb$trigger_type > 0x4000 THEN
      CASE
	      WHEN MOD(rdb$trigger_type,1) = 1 THEN 'AFTER '
		  ELSE 'BEFORE '
      END ||
      CASE (rdb$trigger_type - 0x4000)
        WHEN 0x2 THEN 'CREATE TABLE'
        WHEN 0x4 THEN 'ALTER TABLE'
        WHEN 0x8 THEN 'DROP TABLE'
        WHEN 0x10 THEN 'CREATE PROCEDURE'
        WHEN 0x20 THEN 'ALTER PROCEDURE'
        WHEN 0x40 THEN 'DROP PROCEDURE'
        WHEN 0x80 THEN 'CREATE FUNCTION'
        WHEN 0x100 THEN 'ALTER FUNCTION'
        WHEN 0x200 THEN 'DROP FUNCTION'
        WHEN 0x400 THEN 'CREATE TRIGGER'
        WHEN 0x800 THEN 'ALTER TRIGGER'
        WHEN 0x1000 THEN 'DROP TRIGGER'
        WHEN 0x10000 THEN 'CREATE EXCEPTION'
        WHEN 0x20000 THEN 'ALTER EXCEPTION'
        WHEN 0x40000 THEN 'DROP EXCEPTION'
        WHEN 0x80000 THEN 'CREATE VIEW'
        WHEN 0x100000 THEN 'ALTER VIEW'
        WHEN 0x200000 THEN 'DROP VIEW'
        WHEN 0x400000 THEN 'CREATE DOMAIN'
        WHEN 0x800000 THEN 'ALTER DOMAIN'
        WHEN 0x1000000 THEN 'DROP DOMAIN'
        WHEN 0x2000000 THEN 'CREATE ROLE'
        WHEN 0x4000000 THEN 'ALTER ROLE'
        WHEN 0x8000000 THEN 'DROP ROLE'
        WHEN 0x10000000 THEN 'CREATE INDEX'
        WHEN 0x20000000 THEN 'ALTER INDEX'
        WHEN 0x40000000 THEN 'DROP INDEX'
        WHEN 0x80000000 THEN 'CREATE SEQUENCE'
        WHEN 0x100000000 THEN 'ALTER SEQUENCE'
        WHEN 0x200000000 THEN 'DROP SEQUENCE'
        WHEN 0x400000000 THEN 'CREATE USER'
        WHEN 0x800000000 THEN 'ALTER USER'
        WHEN 0x1000000000 THEN 'DROP USER'
        WHEN 0x2000000000 THEN 'CREATE COLLATION'
        WHEN 0x4000000000 THEN 'DROP COLLATION'
        WHEN 0x8000000000 THEN 'ALTER CHARACTER SET'
        WHEN 0x10000000000 THEN 'CREATE PACKAGE'
        WHEN 0x20000000000 THEN 'ALTER PACKAGE'
        WHEN 0x40000000000 THEN 'DROP PACKAGE'
        WHEN 0x80000000000 THEN 'CREATE PACKAGE BODY'
        WHEN 0x100000000000 THEN 'DROP PACKAGE BODY'
        WHEN 0x200000000000 THEN 'CREATE MAPPING'
        WHEN 0x400000000000 THEN 'ALTER MAPPING'
        WHEN 0x800000000000 THEN 'DROP MAPPING'
      END
    ELSE	
      CASE rdb$trigger_type
	       WHEN 0x7FFFFFFFFFFFDFFE THEN 'BEFORE ANY DDL STATEMENT'
	       WHEN 0x7FFFFFFFFFFFDFFF THEN 'AFTER ANY DDL STATEMENT'
                                   ELSE 'UNKNOWN DDL STATMENT'
	  END
    END || ASCII_CHAR(10) ||
    CASE
       WHEN rdb$trigger_sequence IS NOT NULL AND rdb$trigger_sequence > 0
            THEN 'POSITION ' || rdb$trigger_sequence || ASCII_CHAR(10)
            ELSE ''
   END ||
   rdb$trigger_source AS recreate_statement
FROM rdb$triggers
WHERE (rdb$system_flag IS NULL OR rdb$system_flag = 0)
  AND rdb$trigger_name = 'DETAIL_SYNC'
